name: Mirror to Epitech

on:
  push:
    branches: [ main ]

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Mirror to Epitech
        env:
          # This token must be stored in Your Repo (FreshGroceryApp) -> Settings -> Secrets -> Actions
          EPITECH_PAT: ${{ secrets.EPITECH_PAT }}
          TARGET_REPO: "https://github.com/EpitechMscInternationalPromo2027/I-DEV-702-INT-7-1-trinitydevweb-4.git"
        run: |
          if [ -z "$EPITECH_PAT" ]; then
            echo "Error: EPITECH_PAT secret is missing!"
            exit 1
          fi
          
          # Configure URL with auth token
          # We strip the 'https://' from TARGET_REPO if present to avoid doubling it, though git handles it usually.
          # Safer syntax: https://<token>@github.com/...
          
          # Extract the path part of the URL (remove https://github.com/)
          REPO_PATH="EpitechMscInternationalPromo2027/I-DEV-702-INT-7-1-trinitydevweb-4.git"
          
          git remote add epitech "https://oauth2:$EPITECH_PAT@github.com/$REPO_PATH"
          
          echo "Pushing to Epitech..."
          git push epitech main --force
